# #!/usr/bin/env bash

# toggle() {
#   status=$(rfkill -J | gojq -r '.rfkilldevices[] | select(.type == "wlan") | .soft' | head -1)

#   if [ "$status" = "unblocked" ]; then
#     rfkill block wlan
#   else
#     rfkill unblock wlan
#   fi
# }

# if [ "$1" = "toggle" ]; then
#   toggle
# else
#   while true; do
#     status=$(nmcli g | tail -n 1 | awk '{print $1}')
#     signal=$(nmcli -f in-use,signal dev wifi | rg "\*" | awk '{ print $2 }')
#     essid=$(nmcli -t -f NAME connection show --active | head -n1 | sed 's/\"/\\"/g')

#     icons=("" "" "" "" "")

#     if [ "$status" = "disconnected" ] ; then
#       icon=""
#       color="#988ba2"
#     else
#       level=$(awk -v n="$signal" 'BEGIN{print int((n-1)/20)}')
#       if [ "$level" -gt 4 ]; then
#         level=4
#       fi

#       icon=${icons[$level]}
#       color="#cba6f7"
#     fi

#     echo '{ "essid": "'"$essid"'", "icon": "'"$icon"'", "color": "'"$color"'", "level": "'"$level"'" }'

#     sleep 4
#   done
# fi

#!/usr/bin/env bash

toggle() {
  status=$(rfkill -J | gojq -r '.rfkilldevices[] | select(.type == "wlan") | .soft' | head -1)

  if [ "$status" = "unblocked" ]; then
    rfkill block wlan
  else
    rfkill unblock wlan
  fi
}

if [ "$1" = "toggle" ]; then
  toggle
else
  while true; do
    status=$(nmcli g | tail -n 1 | awk '{print $1}')
    signal=$(nmcli -f in-use,signal dev wifi | rg "\*" | awk '{ print $2 }')
    essid=$(nmcli -t -f NAME connection show --active | head -n1 | sed 's/\"/\\"/g')

    icons=("" "" "" "" "")

    if [ "$status" = "disconnected" ] ; then
      level=0
      icon=""
      color="#988ba2"
    else
      level=$(awk -v n="$signal" 'BEGIN{print int((n-1)/20)}')
      if [ "$level" -gt 4 ]; then
        level=4
      fi

      icon=${icons[$level]}
      color="#cba6f7"
    fi

    echo '{ "essid": "'"$essid"'", "icon": "'"$icon"'", "color": "'"$color"'", "level": "'"$level"'" }'

    sleep 4
  done
fi

# #!/usr/bin/env bash
# nm_is_running() {
#   if ! timeout 2 nmcli -t -f RUNNING general status >/dev/null; then
#     echo "Error: NetworkManager is not running"
#     exit 1
#   fi
# }

# toggle_wifi() {
#   wifi_status=$(timeout 2 nmcli radio wifi)
#   if [ "$wifi_status" = "enabled" ]; then
#     timeout 2 nmcli radio wifi off
#     echo "Wi-Fi turned OFF"
#   else
#     timeout 2 nmcli radio wifi on
#     echo "Wi-Fi turned ON"
#   fi
# }

# toggle_eth() {
#   device="$1"
#   state=$(timeout 2 nmcli device status | awk -v dev="$device" '$1 == dev {print $3}')
#   if [ "$state" = "connected" ]; then
#     timeout 2 nmcli device disconnect "$device"
#     echo "Ethernet $device disconnected"
#   elif [ "$state" = "disconnected" ]; then
#     timeout 2 nmcli device connect "$device"
#     echo "Ethernet $device connected"
#   fi
# }

# toggle() {
#   nm_is_running
#   active_eth=$(timeout 2 nmcli device status | awk '$2 == "ethernet" {print $1}' | head -n1)
#   active_wifi=$(timeout 2 nmcli device status | awk '$2 == "wifi" {print $1}' | head -n1)
#   eth_state=$(timeout 2 nmcli device status | awk -v dev="$active_eth" '$1 == dev {print $3}')
#   wifi_state=$(timeout 2 nmcli device status | awk -v dev="$active_wifi" '$1 == dev {print $3}')

#   if [ -n "$active_wifi" ] && [ "$wifi_state" = "connected" ]; then
#     toggle_wifi
#   elif [ -n "$active_wifi" ] && [ "$wifi_state" = "disconnected" ]; then
#     toggle_wifi
#   elif [ -n "$active_eth" ]; then
#     toggle_eth "$active_eth"
#   else
#     timeout 2 nmcli radio wifi on
#     echo "No connection, Wi-Fi turned ON"
#   fi
# }

# nm_is_running

# if [ "$1" = "toggle" ]; then
#   toggle
# else
#   while true; do
#     active_eth=$(timeout 2 nmcli device status | awk '$2 == "ethernet" {print $1}' | head -n1)
#     eth_state=""
#     [ -n "$active_eth" ] && eth_state=$(timeout 2 nmcli device status | awk -v dev="$active_eth" '$1 == dev {print $3}')

#     active_wifi=$(timeout 2 nmcli device status | awk '$2 == "wifi" {print $1}' | head -n1)
#     wifi_state=""
#     [ -n "$active_wifi" ] && wifi_state=$(timeout 2 nmcli device status | awk -v dev="$active_wifi" '$1 == dev {print $3}')

#     if [ -n "$active_eth" ] && [ "$eth_state" = "connected" ]; then
#       icon="󰈀"
#       color="#89b4fa"
#       essid=$(timeout 2 nmcli device show "$active_eth" | grep 'IP4.ADDRESS' | awk '{print $2}' | cut -d'/' -f1)
#       level=5
#     elif [ -n "$active_wifi" ] && [ "$wifi_state" = "connected" ]; then
#       status=$(timeout 2 nmcli -g STATE general)
#       signal=$(timeout 2 nmcli -f in-use,signal dev wifi | rg "\*" | awk '{ print $2 }')
#       essid=$(timeout 2 nmcli -t -f NAME connection show --active | head -n1 | sed 's/\"/\\"/g')

#       icons=("" "" "" "" "")
#       level=$(awk -v n="$signal" 'BEGIN{print int((n-1)/20)}')
#       if [ "$level" -gt 4 ]; then
#         level=4
#       fi
#       icon=${icons[$level]}
#       color="#cba6f7"
#     elif [ -n "$active_eth" ] && [ "$eth_state" = "disconnected" ]; then
#       icon="󰈀"
#       color="#989898"
#       essid="Ethernet Disconnected"
#       level=0
#     elif [ -n "$active_wifi" ] && [ "$wifi_state" = "disconnected" ]; then
#       icon=""
#       color="#988ba2"
#       essid="Wi-Fi Disconnected"
#       level=0
#     else
#       icon=""
#       color="#988ba2"
#       essid="No Connection"
#       level=0
#     fi

#     echo '{ "essid": "'"$essid"'", "icon": "'"$icon"'", "color": "'"$color"'", "level": "'"$level"'" }'

#     sleep 4
#   done
# fi