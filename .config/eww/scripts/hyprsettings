# #!/usr/bin/bash
# getoptions(){
#   rounding=$(hyprctl getoption decoration:rounding -j | gojq -r -c '.int')
#   gaps_in=$(hyprctl getoption general:gaps_in -j | gojq -r -c '.int')
#   gaps_out=$(hyprctl getoption general:gaps_out -j | gojq -r -c '.int')
#   border_size=$(hyprctl getoption general:border_size -j | gojq -r -c '.int')
#   force_no_accel=$(hyprctl getoption input:force_no_accel -j | gojq -r -c '.int')
#   input_sensitivity=$(hyprctl getoption input:sensitivity -j | gojq -r -c '.float')
#   touchpad_disable_while_typing=$(hyprctl getoption input:touchpad:disable_while_typing -j | gojq -r -c '.int')
#   touchpad_clickfinger_behavior=$(hyprctl getoption input:touchpad:clickfinger_behavior -j | gojq -r -c '.int')
#   blur=$(hyprctl getoption decoration:blur:enabled -j | gojq -r -c '.int')
#   blur_size=$(hyprctl getoption decoration:blur:size -j | gojq -r -c '.int')
#   blur_passes=$(hyprctl getoption decoration:blur:passes -j | gojq -r -c '.int')
#   blur_xray=$(hyprctl getoption decoration:blur:xray -j | gojq -r -c '.int')
#   nightlight=$(hyprctl getoption decoration:screen_shader -j | gojq -r -c '.str')
#   overlay=$(hyprctl getoption debug:overlay -j | gojq -r -c '.int')
#   damage_tracking=$(hyprctl getoption debug:damage_tracking -j | gojq -r -c '.int')
#   if [[ "$nightlight" == *"nothing.frag" || "$nightlight" == "[[EMPTY]]" || "$nightlight" == "" ]]; then
#     nightlight='false'
#   else
#     nightlight='true'
#   fi

#   echo -n '{'
#   echo -n "\"rounding\":$rounding,"
#   echo -n "\"gaps_in\":$gaps_in,"
#   echo -n "\"gaps_out\":$gaps_out,"
#   echo -n "\"border_size\":$border_size,"
#   echo -n "\"force_no_accel\":$force_no_accel,"
#   echo -n "\"input_sensitivity\":$input_sensitivity,"
#   echo -n "\"touchpad_disable_while_typing\":$touchpad_disable_while_typing,"
#   echo -n "\"touchpad_clickfinger_behavior\":$touchpad_clickfinger_behavior,"
#   echo -n "\"blur\":$blur,"
#   echo -n "\"blur_size\":$blur_size,"
#   echo -n "\"blur_passes\":$blur_passes,"
#   echo -n "\"blur_xray\":$blur_xray,"
#   echo -n "\"nightlight\":$nightlight,"
#   echo -n "\"overlay\":$overlay,"
#   echo -n "\"damage_tracking\":$damage_tracking,"

#   echo '"dummy":0}'
# }

# getoptions

# if [ "$1" == "--once" ]; then
#   exit 0
# elif [ "$1" == "tickle" ]; then
#   hyprctl keyword input:force_no_accel $(hyprctl getoption input:force_no_accel -j | gojq -r -c '.int')
# else
#   # # find the Hyprland socket
#   # socket=$(ls -1d $XDG_RUNTIME_DIR/hypr/$HYPRLAND_INSTANCE_SIGNATURE/.socket2.sock 2>/dev/null | head -n1)
#   # if [ -n "$socket" ]; then
#   #   listen to socket events
#   #   socat -u UNIX-CONNECT:"$socket" - \
#   #     | rg --line-buffered "activelayout>>" \
#   #     | while read -r line; do
#   #         getoptions
#   #       done
#   # else
#   #   # fallback to hyprctl dispatchers
#   #   hyprctl dispatchers \
#   #     | rg --line-buffered "activelayout>>" \
#   #     | while read -r line; do
#   #         getoptions
#   #       done
#   # fi
#   socat -u UNIX-CONNECT:$XDG_RUNTIME_DIR/hypr/$HYPRLAND_INSTANCE_SIGNATURE/.socket2.sock - | rg --line-buffered "activelayout>>" | while read -r line; do
#     echo $line
#     getoptions
#   done
# fi
#!/usr/bin/bash
getoptions(){
  get_value_or_default() {
    local value=$1
    local default=$2
    if [[ "$value" == "null" || -z "$value" ]]; then
      echo "$default"
    else
      echo "$value"
    fi
  }

  parse_custom_gaps() {
    local custom=$1
    local default=$2
    if [[ "$custom" == "null" || -z "$custom" ]]; then
      echo "$default"
    else
      echo "$custom" | awk '{print $1}'
    fi
  }

  rounding=$(get_value_or_default "$(hyprctl getoption decoration:rounding -j | gojq -r -c '.int')" 15)
  gaps_in=$(parse_custom_gaps "$(hyprctl getoption general:gaps_in -j | gojq -r -c '.custom')" 4)
  gaps_out=$(parse_custom_gaps "$(hyprctl getoption general:gaps_out -j | gojq -r -c '.custom')" 4)
  border_size=$(get_value_or_default "$(hyprctl getoption general:border_size -j | gojq -r -c '.int')" 2)
  force_no_accel=$(get_value_or_default "$(hyprctl getoption input:force_no_accel -j | gojq -r -c '.int')" 0)
  input_sensitivity=$(get_value_or_default "$(hyprctl getoption input:sensitivity -j | gojq -r -c '.float')" 0)
  touchpad_disable_while_typing=$(get_value_or_default "$(hyprctl getoption input:touchpad:disable_while_typing -j | gojq -r -c '.int')" 1)
  touchpad_clickfinger_behavior=$(get_value_or_default "$(hyprctl getoption input:touchpad:clickfinger_behavior -j | gojq -r -c '.int')" 1)
  blur=$(get_value_or_default "$(hyprctl getoption decoration:blur:enabled -j | gojq -r -c '.int')" 1)
  blur_size=$(get_value_or_default "$(hyprctl getoption decoration:blur:size -j | gojq -r -c '.int')" 7)
  blur_passes=$(get_value_or_default "$(hyprctl getoption decoration:blur:passes -j | gojq -r -c '.int')" 4)
  blur_xray=$(get_value_or_default "$(hyprctl getoption decoration:blur:xray -j | gojq -r -c '.int')" 1)
  nightlight=$(hyprctl getoption decoration:screen_shader -j | gojq -r -c '.str')
  overlay=$(get_value_or_default "$(hyprctl getoption debug:overlay -j | gojq -r -c '.int')" 0)
  damage_tracking=$(get_value_or_default "$(hyprctl getoption debug:damage_tracking -j | gojq -r -c '.int')" 0)
  if [[ "$nightlight" == *"nothing.frag" || "$nightlight" == "[[EMPTY]]" || "$nightlight" == "" ]]; then
    nightlight='false'
  else
    nightlight='true'
  fi

  echo -n '{'
  echo -n "\"rounding\":$rounding,"
  echo -n "\"gaps_in\":$gaps_in,"
  echo -n "\"gaps_out\":$gaps_out,"
  echo -n "\"border_size\":$border_size,"
  echo -n "\"force_no_accel\":$force_no_accel,"
  echo -n "\"input_sensitivity\":$input_sensitivity,"
  echo -n "\"touchpad_disable_while_typing\":$touchpad_disable_while_typing,"
  echo -n "\"touchpad_clickfinger_behavior\":$touchpad_clickfinger_behavior,"
  echo -n "\"blur\":$blur,"
  echo -n "\"blur_size\":$blur_size,"
  echo -n "\"blur_passes\":$blur_passes,"
  echo -n "\"blur_xray\":$blur_xray,"
  echo -n "\"nightlight\":$nightlight,"
  echo -n "\"overlay\":$overlay,"
  echo -n "\"damage_tracking\":$damage_tracking,"
  echo '"dummy":0}'
}

getoptions

if [ "$1" == "--once" ]; then
  exit 0
elif [ "$1" == "tickle" ]; then
  hyprctl keyword input:force_no_accel $(hyprctl getoption input:force_no_accel -j | gojq -r -c '.int')
else
  socat -u UNIX-CONNECT:$XDG_RUNTIME_DIR/hypr/$HYPRLAND_INSTANCE_SIGNATURE/.socket2.sock - | rg --line-buffered "activelayout>>" | while read -r line; do
    getoptions
  done
fi